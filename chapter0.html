<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Red Echo â€“ Chapter 0</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />

    <style>
      /******************************************************
       * RESET & BASE
       ******************************************************/
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        background: #000;
        font-family: "Share Tech Mono", monospace;
        color: #f0f0f0;
        position: relative;
        overflow-x: hidden;
      }
      /* Neon grid background */
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            0deg,
            transparent 24%,
            rgba(57, 255, 20, 0.15) 25%,
            rgba(57, 255, 20, 0.15) 26%,
            transparent 27%,
            transparent 74%,
            rgba(255, 20, 147, 0.15) 75%,
            rgba(255, 20, 147, 0.15) 76%,
            transparent 77%,
            transparent
          ),
          linear-gradient(
            90deg,
            transparent 24%,
            rgba(57, 255, 20, 0.15) 25%,
            rgba(57, 255, 20, 0.15) 26%,
            transparent 27%,
            transparent 74%,
            rgba(255, 20, 147, 0.15) 75%,
            rgba(255, 20, 147, 0.15) 76%,
            transparent 77%,
            transparent
          );
        background-size: 50px 50px;
        z-index: -2;
        transform: translateX(-50%);
        animation: gridPulse 10s ease-in-out infinite;
      }
      @keyframes gridPulse {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }
      /* Glitch overlay for extra effect */
      .glitch-overlay {
        pointer-events: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: repeating-linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.01) 0px,
          rgba(255, 255, 255, 0.01) 1px,
          transparent 1px,
          transparent 2px
        );
        mix-blend-mode: overlay;
        animation: glitchFlicker 0.35s infinite;
        z-index: 1000;
      }
      @keyframes glitchFlicker {
        0%,
        19%,
        21%,
        100% {
          opacity: 0.05;
          transform: none;
        }
        20% {
          opacity: 0.15;
          transform: translateX(-1px);
        }
      }
      /* HEADER */
      header {
        text-align: center;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.85);
        box-shadow: 0 0 25px #ff1493, 0 0 25px #39ff14;
        z-index: 1;
      }
      header img {
        max-width: 100%;
        height: auto;
        transition: transform 0.5s ease;
      }
      header img:hover {
        transform: scale(1.05);
      }
      .location-image {
        display: block;
        width: 45%;
        max-width: 375px;
        margin: 1.5rem auto;
        border: 3px solid #ff1493;
        box-shadow: 0 0 30px #ff1493;
        border-radius: 10px;
      }
      /* AUDIO CONTAINER */
      .audio-container {
        background: rgba(0, 0, 0, 0.95);
        padding: 1.5rem;
        border: 3px solid #ff1493;
        width: 90%;
        max-width: 750px;
        margin: 2rem auto;
        box-shadow: 0 0 30px #ff1493;
        text-align: center;
        border-radius: 10px;
        position: relative;
        z-index: 1;
      }
      audio {
        width: 100%;
        max-width: 600px;
        outline: none;
      }
      .map-container {
        width: 90%;
        max-width: 800px;
        margin: 1.5rem auto;
        border: 2px solid #ff1493;
        box-shadow: 0 0 20px #ff1493;
        border-radius: 10px;
        overflow: hidden;
      }
      /* Transcript Box */
      .transcript {
        max-width: 800px;
        margin: 2rem auto;
        background: rgba(10, 10, 10, 0.95);
        padding: 1.5rem;
        border: 2px solid #ff1493;
        font-family: "Share Tech Mono", monospace;
        color: #d0ffd0;
        line-height: 1.6;
        box-shadow: 0 0 20px #ff1493;
        border-radius: 10px;
        position: relative;
        z-index: 1;
        overflow: hidden;
        white-space: pre-wrap;
      }
        font-family: "Share Tech Mono", monospace;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 0 15px #39ff14;
        opacity: 0.3;
        pointer-events: none;
      }
      .continue-btn:hover {
        background: black;
        color: #ff1493;
        border: 1px solid #ff1493;
      }
      /* Skip Button */
      .skip-btn {
        display: block;
        margin: 1rem auto;
        background: #ff1493;
        color: black;
        font-size: 1rem;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 5px;
        font-family: "Share Tech Mono", monospace;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 0 15px #39ff14;
      }
      .skip-btn:hover {
        background: black;
        color: #ff1493;
        border: 1px solid #ff1493;
      }
    </style>
  </head>

  <body>
    <!-- Glitch Overlay for extra visual effect -->
    <div class="glitch-overlay"></div>

    <!-- HEADER IMAGE -->
    <header>
      <img
        src="https://cdn.glitch.global/2e70430a-ca46-4dbe-92eb-a8fbb38cb0fe/Redechoheader.png?v=1742951549074"
        alt="Red Echo Header"
      />
    </header>

    <img src="parkslopeapt.png" alt="Park Slope Apartment" class="location-image" />

    <!-- Audio Container with narration -->
    <div class="audio-container">
      <audio id="chapterAudio" crossorigin="anonymous" controls>
        <source
          src="https://cdn.glitch.me/b1804eef-ad83-4ae9-af9f-1fba1e23a51b/r3d3ch0chapter0.wav?v=1743092999478"
          type="audio/wav"
        />
        Your browser does not support the audio element.
      </audio>
        <canvas id="visualizerCanvas" width="700" height="100"></canvas>
    </div>


    <!-- Transcript Container -->
    <div class="transcript" id="transcript"></div>

    <!-- Map from Chapter 1 shown after transcript -->
    <div class="map-container" id="chapterMap" style="display:none;">
      <iframe src="retro_mta_story_map.html" width="100%" height="450" style="border:none"></iframe>
    </div>

    <!-- Skip & Continue Buttons -->
    <button class="skip-btn" id="skipBtn" onclick="skipText()">Skip</button>
      <button class="continue-btn" id="continueBtn" onclick="triggerFlicker()">
        Continue &gt;
      </button>
<script>
  const audio = document.getElementById('chapterAudio'); // Your existing audio element
  const canvas = document.getElementById('visualizerCanvas');
  const ctx = canvas.getContext('2d');

  let audioCtx;
  let analyser;
  let source;

  function resizeCanvas() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function initVisualizer() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;

      source = audioCtx.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(audioCtx.destination);
    }
  }

  function drawVisualizer() {
    if (!analyser) return;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);
    analyser.getByteFrequencyData(dataArray);

    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / bufferLength;
    dataArray.forEach((value, i) => {
      const barHeight = (value / 255) * canvas.height;
      ctx.fillStyle = i % 2 === 0 ? '#39FF14' : '#FF1493';
      ctx.fillRect(i * barWidth, canvas.height - barHeight, barWidth - 1, barHeight);
    });

    requestAnimationFrame(drawVisualizer);
  }

  audio.addEventListener('play', () => {
    initVisualizer();
    if (audioCtx.state === 'suspended') {
      audioCtx.resume();
    }
    drawVisualizer();
  });
</script>
<script src="js/transcribe.js"></script>
<script>
  const transcriptContainer = document.getElementById("transcript");
  attachTranscription(audio);
  const continueBtn = document.getElementById("continueBtn");
  function skipText() {
    audio.pause();
    continueBtn.style.opacity = "1";
    continueBtn.style.pointerEvents = "auto";
  }
  function triggerFlicker() {
    document.body.classList.add("flicker");
    setTimeout(() => {
      window.location.href = "chapter1.html";
    }, 300);
  }
</script>
  </body>
</html>
